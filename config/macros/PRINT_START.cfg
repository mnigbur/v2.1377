[gcode_macro PRINT_START]
gcode:
    {% set TEMP_BED = params.BED|default(60)|float %}
    {% set TEMP_EXTRUDER = params.EXTRUDER|default(190)|float %}

    {% if 'temperature_fan exhaust' in printer %}
        SET_TEMPERATURE_FAN_TARGET temperature_fan=exhaust target={% if TEMP_BED|float <= 80 %}40{% else %}70{% endif %}
    {% endif %}

    M117 Heating bed
    M190 S{TEMP_BED} ; set bed temp

    M117 Preheating nozzle
    M109 S180               ; preheat nozzle 

    M107 ; print fan off

    M104 S{TEMP_EXTRUDER} ; start heating extruder to target temp

    G32 ; Home XYZ and do QGL

    M117 Heating nozzle
    M109 S{TEMP_EXTRUDER} ; wait for extruder temp

    PRIME_LINE

    ; BED_MESH_PROFILE LOAD=default
    M117 Printing...
